<!-- templates/home.html -->
{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <div class="detection-mode-selector">
        <button id="liveMode" class="mode-btn active">Live Detection</button>
        <button id="uploadMode" class="mode-btn">Upload Files</button>
    </div>

    <!-- Live Detection Section -->
    <div id="liveModeSection" class="detection-section">
        <div class="camera-container">
            <video id="videoElement" autoplay playsinline></video>
            <canvas id="canvasElement" style="display: none;"></canvas>
            <div class="controls">
                <button id="cameraButton">Start Camera</button>
                <button id="captureButton" disabled>Capture</button>
            </div>
        </div>
        <div id="liveResults" class="results-container"></div>
    </div>

    <!-- File Upload Section -->
    <div id="uploadModeSection" class="detection-section" style="display: none;">
        <div class="upload-container">
            <form id="uploadForm" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="file-input-container">
                    <input type="file" id="fileInput" name="file" accept="image/*,video/*" multiple>
                    <label for="fileInput" class="file-label">Choose Files</label>
                </div>
                <button type="submit" class="upload-btn">Upload & Detect</button>
            </form>
        </div>
        <div id="uploadResults" class="results-container"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/camera.js' %}"></script>
<script src="{% static 'js/upload.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const camera = new CameraHandler();
    const uploader = new FileUploadHandler();
    
    // Mode switching
    const liveMode = document.getElementById('liveMode');
    const uploadMode = document.getElementById('uploadMode');
    const liveModeSection = document.getElementById('liveModeSection');
    const uploadModeSection = document.getElementById('uploadModeSection');

    liveMode.addEventListener('click', () => {
        liveMode.classList.add('active');
        uploadMode.classList.remove('active');
        liveModeSection.style.display = 'block';
        uploadModeSection.style.display = 'none';
    });

    uploadMode.addEventListener('click', () => {
        uploadMode.classList.add('active');
        liveMode.classList.remove('active');
        uploadModeSection.style.display = 'block';
        liveModeSection.style.display = 'none';
        camera.stopCamera();
    });
});
</script>
{% endblock %}